<!DOCTYPE html>
<html>
    <head>
        <title>Seacial Media - Admin Page</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/uikit.min.css" />
        <link rel="stylesheet" href="css/style.css" />
        <script src="js/seacial-localstorage.js"></script>
        <style>

.ma-table
{ 
  display: table;
}

.ma-tableRow
{
  display: table-row; 
}

.ma-tableBody
{
  display: table-row-group;
}

.ma-tableFoot
{
  display: table-footer-group;
}

.ma-tableCell, .ma-tableHead
{
  display: table-cell; 
}

.ma-table 
{
  display: table;
  width: 100%;
}
.ma-tableRow
{
  display: table-row;
}
.ma-tableHead
{
  background-color: #ddd;
}

.ma-tableCell, .ma-tableHead 
{
  display: table-cell;
  padding: 3px 10px;
  border: 1px solid #999999;
}

.ma-tableHead
{
/*RICK: deze gooide roet in het eten, header zag er raar uit... Ayal
  display: table-header-group;
*/
  background-color: #ddd;
  font-weight: bold;
}

.ma-tableFoot 
{
  display: table-footer-group;
  font-weight: bold;
  background-color: #ddd;
}
.ma-tableBody 
{
  display: table-row-group;
}


        </style>




<script>
var prev_onload_admin = window.onload;
window.onload = onload_admin;
function onload_admin()
{
    if (prev_onload_admin) {
	prev_onload_admin();
    }
    repopulateUsers();
    repopulateMessages();
    repopulateRequests();
}





function repopulateUsers() {
    repopulate("users","list-users", "USERS", userinfoFields);
}

function repopulateMessages() {
    repopulate("messages","list-messages", "MESSAGES", messageinfoFields);
}

function repopulateRequests() {
    repopulate("requests","list-requests", "REQUESTS", requestinfoFields);
}


function repopulate(tableid, elementid, section, infofields) {
    var table = getStorageObject()[tableid];
    var tableElement = document.getElementById(elementid);
    if (tableElement) {
        var text = "";

        text += MaTableBegin();
        text += MaSectionBegin(section, "section-"+tableid, infofields);

	for (var key in table) {
	    // skip loop if the property is from prototype
	    if(!table.hasOwnProperty(key)) {
        	continue;
	    }
            text += MaAdd(key, table[key], ""+tableid+"_Operation_");
	}

        text += MaSectionEnd();
        text += MaTableEnd();
	tableElement.innerHTML = text; 
    }
}






function users_Operation_change(key, row) {
    var newUserInfo = {};
    for (var i=0;i<userinfoFields.length;i++) {
        var element = document.getElementById("cell-"+row+"-"+userinfoFields[i]);
	if (element) {
	    newUserInfo[userinfoFields[i]] = element.innerHTML;
	    //alert("Value for "+userinfoFields[i]+" = "+element.innerHTML);
	}
    }
    updateUser(key,newUserInfo);
    repopulateUsers();
}

function users_Operation_delete(key) {
    removeUser(key);
    repopulateUsers();
}


function messages_Operation_delete(key) {
    removeMessage(key);
    repopulateMessages();
}


function messages_Operation_change(key, row) {
    var newMessageInfo = {};
    for (var i=0;i<messageinfoFields.length;i++) {
        var element = document.getElementById("cell-"+row+"-"+messageinfoFields[i]);
	if (element) {
	    newMessageInfo[messageinfoFields[i]] = element.innerHTML;
	    //alert("Value for "+userinfoFields[i]+" = "+element.innerHTML);
	}
    }
    updateMessage(key,newMessageInfo);
    repopulateMessages();
}








function requests_Operation_delete(key) {
    removeRequest(key);
    repopulateRequests();
}


function requests_Operation_change(key, row) {
    var newRequestInfo = {};
    for (var i=0;i<requestinfoFields.length;i++) {
        var element = document.getElementById("cell-"+row+"-"+requestinfoFields[i]);
	if (element) {
	    newRequestInfo[requestinfoFields[i]] = element.innerHTML;
	    //alert("Value for "+userinfoFields[i]+" = "+element.innerHTML);
	}
    }
    updateRequest(key,newRequestInfo);
    repopulateRequests();
}











function toggleVisibility(section) {
    if (sectionVisibility[section] == "table-cell") {
	sectionVisibility[section] = "none";
    }
    else {
	sectionVisibility[section] = "table-cell";
    }

    var elements = document.getElementsByClassName(section)
    for (var i = 0; i < elements.length; i++) {
	elements[i].style.display = sectionVisibility[section];
    }
}

var sectionVisibility = {};

function MaTableBegin() {
    var text="";

    sectionClass = "";
    text += "<div class='ma-table'>";

    return text;
}

function MaTableEnd() {
    var text="";

    text += "</div>";

    return text;
}

var sectionRow=0;

function MaSectionBegin(sectionTitle, section, infoFields) {
    sectionRow=0;

    var text="";

    sectionClass = section;
    sectionVisibility[sectionClass] = "table-cell";
    text += "  <div class='ma-tableRow'>";
    text += "    <div class='ma-tableHead'><a href='javascript:toggleVisibility(\""+sectionClass+"\")'>"+sectionTitle+"</a></div>";

    for (var i=0;i<infoFields.length;i++) {
	text += "    <div class='ma-tableHead'>"+infoFields[i]+"</div>";
    }
    text += "    <div class='ma-tableHead'>EDIT</div>";
    text += "    <div class='ma-tableHead'>DELETE</div>";
    text += "  </div>";

    return text;
}

function MaAdd(key, info,baseModifier)
{
    sectionRow ++;

    var text="";

    text += "  <div class='ma-tableRow'>";
    text += "    <div class='ma-tableCell "+sectionClass+"'>"+key+"</div>";

    for (var field in info) {
	// skip loop if the property is from prototype
	if(!info.hasOwnProperty(field)) {
            continue;
	}
        text += "    <div class='ma-tableCell "+sectionClass+"' id='cell-"+sectionRow+"-"+field+"' contenteditable='true' onkeypress='preventEnter(event)'>"+info[field]+"</div>";
    }

    text += "    <div class='ma-tableCell "+sectionClass+"'><a href='javascript:"+baseModifier+"change(\""+key+"\","+sectionRow+")'>Update</a></div>";
    text += "    <div class='ma-tableCell "+sectionClass+"'><a href='javascript:"+baseModifier+"delete(\""+key+"\")' onclick='confirm(\"Are you sure you want to remove user "+key+"?\")'>Remove</a></div>";
    text += "  </div>";
    return text;
}

function MaSectionEnd()
{
    var text="";
    return text;
}



function preventEnter(e) {
    if (e.keyCode === 10 || e.keyCode === 13) {
        e.preventDefault();
    }
}


var newNames = 
[
  "conor",
  "smith",
  "jones",
  "williams",
  "powell",
  "brown",  
  "wilson",
  "taylor",
  "nguyen",
  "johnson",
  "martin",
  "white",
  "anderson",
  "walker",
  "thompson",
  "thomas",
  "lee", 
  "harris",
  "ryan",
  "robinson",
  "kelly",
  "king"
];

var firstNames = 
[
  "John",
  "Sarah",
  "Jack",
  "Jennifer",
  "Frank",
];


function selectAdRandomFrom(list) {
    return list[Math.floor(Math.random()*list.length)];
}


function addNewUser() {
    var username = null;
    for (var i=0;i<newNames.length;i++) {
	if (!userExists(newNames[i])) {
		username = newNames[i];
		break;
        }
    }
    if (!username) {
        username=getNewUniqueId("user");
    }
    
    var firstname = selectAdRandomFrom(firstNames);

    var institute="";
    var boatName="";
    var role = "";
    if (Math.random()>0.5)
    {
      role="sailor";
      boatName = "Given Time";
    }
    else
    {
      role="academic";
      institute = "UvA";
    }
    
    addUser(username, {
        "firstname":firstname, 
        "role": role,
        "lastname":username, 
	"institute":institute, 
	"boatname":boatName, 
	"email":"contact@seacial.com"
    });
    repopulateUsers();
}

//x repopulateMessages
//getNewUniqueId
//xgetTodayDateString


function getRandomUser() {
    var result = null;
    var users = getStorageObject()["users"];
    for (var key in users) {
        if (result == null)
	{
	  result = key;
	}
        if (Math.random()<0.5) {
	    result = key;
	}
    }
    return result;
}

var sampleMessages = 
[
  "Hey, how are you doing out there on the ocean?",
  "We have some new data for you!",
  "The data is amazing, TA!",
  "We're sorry to inform you that we were not able to capture that data. We got into a storm and had to change route.",
  "Hey, long time no hear! Was the data useful?"
];

function addNewMessage() {
    var type = (Math.random()>0.5) ? "personal" : "administrator"; 
    addMessage(getNewUniqueId("message"), {
        "type":type,
        "from":getRandomUser(), 
        "to": getRandomUser(),
        "description":selectAdRandomFrom(sampleMessages), 
	"date":getTodayDateString(), 
	"previous":""
    });
    repopulateMessages();
}



var sampleStatuses = 
[
  "New",
  "Accepted",
  "Rejected"
];

var sampleRequestTypes = 
[
  "pH of the ocean water",
  "Salinity of the ocean water",
  "3 in the air"
];

var sampleAreas = 
[
  "North Pacific",
  "Indian",
  "Atlantic"
];

function addNewRequest() {
    var type = (Math.random()>0.5) ? "personal" : "administrator"; 
    addRequest(getNewUniqueId("request"), {
        "username":getRandomUser(), 
	"area":selectAdRandomFrom(sampleAreas),
        "description":"Just take as many samples as you can!",
	"reqtype":selectAdRandomFrom(sampleRequestTypes),  
	"status":selectAdRandomFrom(sampleStatuses),
        "duration":"6 months", 
	"frequency":"2 measures per day",
	"deadline":"21-07-2019"


    });
    repopulateRequests();
}



function doResetDatabase() {
    resetDatabase();
    repopulateUsers();
    repopulateMessages();
    repopulateRequests();
}

</script>

    </head>
    <body>

<a href='javascript:doResetDatabase()' onclick='return confirm("Are you sure you want to reste the database?")'>Reset database</a>

<p>
<h1>Accounts</h1>
<a href='javascript:addNewUser()'>Add new user</a><br>
<div id='list-users'></div>

<p>

<h1>Messages</h1>
<a href='javascript:addNewMessage()'>Add new message</a><br>
<div id='list-messages'></div>
<p>


<h1>Requests</h1>
<a href='javascript:addNewRequest()'>Add new request</a><br>
<div id='list-requests'></div>
<p>



    </body>
</html>
